<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Host Dashboard - Screen Share</title>
<style>
body { font-family: 'Segoe UI', sans-serif; background:#f4f6f8; margin:0; padding:0;}
header { background:#1e88e5; color:#fff; padding:15px; text-align:center; font-size:24px; }
.container { max-width:900px; margin:20px auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 15px rgba(0,0,0,0.1);}
button { padding:10px 20px; font-size:16px; margin:5px; border:none; border-radius:5px; cursor:pointer; }
button:disabled { background:#ccc; cursor:not-allowed;}
#startBtn { background:#43a047; color:#fff; }
#stopBtn { background:#e53935; color:#fff; }
.status { margin-top:15px; font-weight:bold; font-size:16px; }
video { width:100%; border-radius:10px; margin-top:15px; background:#000; }
footer { text-align:center; margin-top:20px; color:#888; font-size:14px; }
</style>
</head>
<body>

<header>Host Dashboard - Screen Share</header>
<div class="container">
    <button id="startBtn">Start Sharing</button>
    <button id="stopBtn" disabled>Stop Sharing</button>
    <div class="status" id="status">Status: Not connected</div>
    <video id="localVideo" autoplay muted playsinline></video>
</div>

<footer>Â© 2025 ScreenShare Pro</footer>

<script>
let pc;
let localStream;
const ws = new WebSocket('ws://localhost:8080');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const statusEl = document.getElementById('status');
const localVideo = document.getElementById('localVideo');

ws.onopen = () => {
    console.log('Connected to signaling server');
    ws.send(JSON.stringify({type:'host'}));
    statusEl.textContent = 'Status: Connected to server';
};

ws.onmessage = async (msg) => {
    const message = JSON.parse(msg.data);
    if(message.type === 'answer') {
        await pc.setRemoteDescription(new RTCSessionDescription(message.data));
        statusEl.textContent = 'Status: Viewer connected & streaming';
        console.log('Answer set');
    } else if(message.type === 'ice') {
        try { await pc.addIceCandidate(message.data); } catch(e){ console.error(e);}
    } else if(message.type === 'newViewer') {
        console.log('Viewer connected');
        statusEl.textContent = 'Status: Viewer connected';
    }
};

async function startSharing() {
    localStream = await navigator.mediaDevices.getDisplayMedia({video:true, audio:true});
    localVideo.srcObject = localStream;

    pc = new RTCPeerConnection();
    localStream.getTracks().forEach(track => pc.addTrack(track, localStream));

    pc.onicecandidate = (event) => {
        if(event.candidate){
            ws.send(JSON.stringify({type:'ice', target:'viewer', data:event.candidate}));
        }
    };

    const offer = await pc.createOffer();
    await pc.setLocalDescription(offer);
    ws.send(JSON.stringify({type:'offer', target:'viewer', data:offer}));

    startBtn.disabled = true;
    stopBtn.disabled = false;
    statusEl.textContent = 'Status: Sharing screen';
}

function stopSharing(){
    if(localStream){
        localStream.getTracks().forEach(t=>t.stop());
        localStream=null;
        localVideo.srcObject=null;
    }
    if(pc){ pc.close(); pc=null; }
    startBtn.disabled=false;
    stopBtn.disabled=true;
    statusEl.textContent='Status: Stopped sharing';
}

startBtn.onclick = startSharing;
stopBtn.onclick = stopSharing;
</script>

</body>
</html>
